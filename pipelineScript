node {

      stage('Initialise') {
        /* Checkout the scripts */
        checkout scm: [
                $class: 'GitSCM',
                userRemoteConfigs: [
                        [
                                url: "https://github.com/gopalcs1988/Selenium_ExtendReport"
                        ]
                ],
                branches: [[name: "master"]]
        ], poll: false
      }
      
      stage('Execute Tests') {
         // Run Maven on a Unix agent.
         // sh "mvn -Dmaven.test.failure.ignore=true clean test"

         // To run Maven on a Windows agent, use
         bat "mvn -Dmaven.test.failure.ignore=true clean test"
      }

    stage('Publish HTML Results') {
	publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: '', reportFiles: '**/Raja.html', reportName: 'HTML Report', reportTitles: ''])
	 }

stage('TestNG Results')
	post {
                // If Maven was able to run the tests, even if some of the test                
                success {
                    testNG '**/target/surefire-reports/TEST-*.xml'
                    
                }
            }
      
    stage('Email Notification'){	
	emailext( 
	subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!', 
	body: '', 
	mimeType: 'text/HTML', 
	presendScript: '''def reportPath = build.getWorkspace().child("test-output/emailable-report.html") msg.setContent(reportPath.readToString(), "text/html")''', 
	replyTo: 'rajagopal1988@gmail.com', 
	to: 'rajagopal1988@gmail.com')
     }
}
